@model DinFlow.Models.DashboardViewModel

@{
    ViewBag.Title = "Home Page";
}
<main class="container">
    <h1 class="text-center my-4">Dashboard Financeiro</h1>
    <div class="d-flex justify-content-center">
        <div class="col-md-4">
            <div class="card mb-4 shadow-sm" style="background-color: @(Model.TotalReceitas - Model.TotalDespesas >= 0 ? "#1ABC9C" : "#E74C3C"); color: white;">
                <div class="card-header text-center">
                    <h4 class="my-0 font-weight-normal">Saldo</h4>
                </div>
                <div class="card-body text-center">
                    <h1 class="card-title pricing-card-title">R$ @(Model.TotalReceitas - Model.TotalDespesas)</h1>
                </div>
            </div>
        </div>

    </div>

    <div class="row text-center">
        <!-- Card Total de Receitas -->
        <div class="col-md-4">
            <div class="card mb-4 shadow-sm">
                <div class="card-header">
                    <h4 class="my-0 font-weight-normal">Total de Receitas</h4>
                </div>
                <div class="card-body">
                    <h1 class="card-title pricing-card-title">R$ @Model.TotalReceitas.ToString("N2")</h1>
                    <p class="card-text">Visualize suas receitas totais.</p>
                    <button class="btn btn-lg btn-block btn-outline-primary" data-bs-toggle="modal" data-bs-target="#cadastrarReceitaModal">
                        Cadastrar Receita
                    </button>
                    <button class="btn btn-sm btn-outline-secondary mt-2 toggle-collapse" data-target="#receitasCollapse">
                        Ver detalhes <i class="fas fa-chevron-right"></i>
                    </button>
                    <div class="collapse mt-2" id="receitasCollapse">
                        <ul class="list-group">
                            @foreach (var receita in Model.Receitas)
                            {
                                <li class="list-group-item">R$ @receita.Valor.ToString("N2") - @receita.Descricao</li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- Card Total de Despesas -->
        <div class="col-md-4">
            <div class="card mb-4 shadow-sm">
                <div class="card-header">
                    <h4 class="my-0 font-weight-normal">Total de Despesas</h4>
                </div>
                <div class="card-body">
                    <h1 class="card-title pricing-card-title">R$ @Model.TotalDespesas.ToString("N2")</h1>
                    <p class="card-text">Visualize suas despesas totais.</p>
                    <button class="btn btn-lg btn-block btn-outline-primary" data-bs-toggle="modal" data-bs-target="#cadastrarDespesaModal">
                        Cadastrar Despesa
                    </button>
                    <button class="btn btn-sm btn-outline-secondary mt-2 toggle-collapse" data-target="#despesasCollapse">
                        Ver detalhes <i class="fas fa-chevron-right"></i>
                    </button>
                    <div class="collapse mt-2" id="despesasCollapse">
                        <ul class="list-group">
                            @foreach (var despesa in Model.Despesas)
                            {
                                <li class="list-group-item">R$ @despesa.Valor.ToString("N2") - @despesa.Descricao</li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- Card Total de Economias -->
        <div class="col-md-4">
            <div class="card mb-4 shadow-sm">
                <div class="card-header">
                    <h4 class="my-0 font-weight-normal">Total de Economias</h4>
                </div>
                <div class="card-body">
                    <h1 class="card-title pricing-card-title">R$ @Model.TotalEconomias.ToString("N2")</h1>
                    <p class="card-text">Visualize suas economias totais.</p>
                    <button class="btn btn-lg btn-block btn-outline-primary" data-bs-toggle="modal" data-bs-target="#cadastrarEconomiaModal">
                        Cadastrar Economia
                    </button>
                    <button class="btn btn-sm btn-outline-secondary mt-2 toggle-collapse" data-target="#economiasCollapse">
                        Ver detalhes <i class="fas fa-chevron-right"></i>
                    </button>
                    <div class="collapse mt-2" id="economiasCollapse">
                        <ul class="list-group">
                            @foreach (var economia in Model.Economias)
                            {
                                <li class="list-group-item">R$ @economia.Valor.ToString("N2") - @economia.Data.ToString("dd/MM/yyyy")</li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </div>
</main>

<!-- Modal para Cadastrar Receita -->
<div class="modal fade" id="cadastrarReceitaModal" tabindex="-1" aria-labelledby="cadastrarReceitaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cadastrarReceitaModalLabel">Cadastrar Receita</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="@Url.Action("Create", "Receitas")">
                    @Html.AntiForgeryToken()
                    <div class="mb-3">
                        <label for="nomeReceita" class="form-label">Nome</label>
                        <input type="text" class="form-control" id="nomeReceita" name="Nome" required>
                    </div>
                    <div class="mb-3">
                        <label for="descricaoReceita" class="form-label">Descrição</label>
                        <input type="text" class="form-control" id="descricaoReceita" name="Descricao" required>
                    </div>
                    <div class="form-group">
                        @Html.Label("Categoria", htmlAttributes: new { @class = "control-label" })
                        <div class="col-md-10" style="display: flex; align-items: center;">
                            @Html.DropDownList("CategoriaId", ViewBag.Categorias as SelectList, "Selecione uma categoria...", new { @class = "form-control", id = "categoriaDropdown" })
                            <button type="button" class="btn btn-success addCategoriaBtn">+</button>
                        </div>
                        @Html.ValidationMessage("CategoriaId", "", new { @class = "text-danger" })
                    </div>
                    <div class="mb-3">
                        <label for="dataReceita" class="form-label">Data</label>
                        <input type="date" class="form-control" id="dataReceita" name="Data" required>
                    </div>
                    <div class="mb-3">
                        <label for="valorReceita" class="form-label">Valor</label>
                        <input type="number" class="form-control" id="valorReceita" name="Valor" required step="0.01" min="0">
                    </div>
                    <button type="submit" class="btn btn-primary">Cadastrar</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Cadastrar Despesa -->
<div class="modal fade" id="cadastrarDespesaModal" tabindex="-1" aria-labelledby="cadastrarDespesaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cadastrarDespesaModalLabel">Cadastrar Despesa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="@Url.Action("Create", "Despesas")">
                    @Html.AntiForgeryToken()
                    <div class="mb-3">
                        <label for="nomeDespesa" class="form-label">Nome</label>
                        <input type="text" class="form-control" id="nomeDespesa" name="Nome" required>
                    </div>
                    <div class="mb-3">
                        <label for="descricaoDespesa" class="form-label">Descrição</label>
                        <input type="text" class="form-control" id="descricaoDespesa" name="Descricao" required>
                    </div>
                    <div class="form-group">
                        @Html.Label("Categoria", htmlAttributes: new { @class = "control-label" })
                        <div class="col-md-10" style="display: flex; align-items: center;">
                            @Html.DropDownList("CategoriaId", ViewBag.Categorias as SelectList, "Selecione uma categoria...", new { @class = "form-control", id = "categoriaDropdownDespesa" })
                            <button type="button" class="btn btn-success addCategoriaBtn">+</button>
                        </div>
                        @Html.ValidationMessage("CategoriaId", "", new { @class = "text-danger" })
                    </div>
                    <div class="mb-3">
                        <label for="dataDespesa" class="form-label">Data</label>
                        <input type="date" class="form-control" id="dataDespesa" name="Data" required>
                    </div>
                    <div class="mb-3">
                        <label for="valorDespesa" class="form-label">Valor</label>
                        <input type="number" class="form-control" id="valorDespesa" name="Valor" required step="0.01" min="0">
                    </div>
                    <button type="submit" class="btn btn-primary">Cadastrar</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Cadastrar Economia -->
<div class="modal fade" id="cadastrarEconomiaModal" tabindex="-1" aria-labelledby="cadastrarEconomiaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cadastrarEconomiaModalLabel">Cadastrar Economia</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="@Url.Action("Create", "Economias")">
                    @Html.AntiForgeryToken()
                    <div class="mb-3">
                        <label for="valorEconomia" class="form-label">Valor</label>
                        <input type="number" class="form-control" id="valorEconomia" name="Valor" required step="0.01" min="0">
                    </div>
                    <div class="mb-3">
                        <label for="dataEconomia" class="form-label">Data</label>
                        <input type="date" class="form-control" id="dataEconomia" name="Data" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Cadastrar</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
    $(document).ready(function () {
        // Adicionar nova categoria
        $('.addCategoriaBtn').on('click', function () {
            var novaCategoria = prompt('Digite o nome da nova categoria:');
            if (novaCategoria) {
                $.ajax({
                    url: '@Url.Action("AdicionarCategoria", "Categorias")',
                    method: 'POST',
                    data: { nomeCategoria: novaCategoria },
                    success: function (response) {
                        $('#categoriaDropdown, #categoriaDropdownDespesa').append($('<option>', {
                            value: response.categoriaId,
                            text: response.nomeCategoria
                        }));
                        alert('Categoria adicionada com sucesso!');
                    },
                    error: function () {
                        alert('Erro ao adicionar categoria.');
                    }
                });
            }
        });

        // Toggle collapse
        $('.toggle-collapse').on('click', function () {
            const target = $(this).data('target');
            $(target).collapse('toggle');
            $(this).find('i').toggleClass('fa-chevron-right fa-chevron-down');
        });
        

    });

    </script>

}
